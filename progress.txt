# Progress Log

This file tracks AI-assisted development progress.
Each entry documents: date, feature, decisions, files changed, tests, and concerns.

---

[2026-01-10] #4 feat: add progress indicator and approval flow to create command
- Files: src/commands/create.ts, src/lib/claude.ts, src/index.ts, src/lib/claude.test.ts
- Changes: Added visual framing around Claude streaming output, ticket preview before creation, inquirer confirmation with create/edit/cancel options, and --yes flag for CI automation.
- Decisions: Used chalk for visual frame borders, accumulated hints across regeneration cycles, truncated body preview at 500 chars.

[2026-01-10] #11 fix: replace bordered table with section-based ticket preview
- Files: src/commands/create.ts
- Changes: Replaced logger.box() bordered table with clean section-based format using chalk styling. Labels displayed inline, body content shown with indentation for readability.
- Decisions: Used bold cyan headers for sections, removed 500-char truncation to show full body content for better review.

[2026-01-10] #10 fix: strip AI preamble from generated ticket bodies
- Files: src/lib/claude.ts, src/lib/claude.test.ts
- Changes: Added explicit instruction in prompt to start with "## Description" without preamble. Updated extractIssueBody to strip any text before "## Description" as safety measure.
- Decisions: Two-layer defense: prompt instruction + extraction cleanup.

[2026-01-11] #9 feat: add multi-model AI provider support (Claude + Gemini)
- Files: src/types/index.ts, src/lib/config.ts, src/lib/ai-provider.ts, src/utils/validators.ts, src/utils/logger.ts, src/commands/run.ts, src/commands/create.ts, src/commands/pr.ts, src/commands/status.ts, src/index.ts, src/lib/ai-provider.test.ts, src/lib/config.test.ts
- Changes: Added AIProvider type and AIConfig interface. Created ai-provider.ts abstraction layer supporting Claude and Gemini CLIs with auto-fallback on rate limits. Added --provider flag to run/create/pr commands. Updated status command to show AI provider info.
- Decisions: Kept claude.ts for prompt building (backward compat), new ai-provider.ts handles invocation. GENT_AI_PROVIDER env var overrides config.

[2026-01-11] #15 feat: add dynamic provider signature to issues and PRs
- Files: src/commands/create.ts, src/commands/pr.ts
- Changes: Appended "Created with {provider} by gent" footer to issue and PR bodies after AI generation.
- Decisions: Footer added programmatically after AI response (not in prompt). Used existing getProviderDisplayName().

[2026-01-11] #17 fix: update issue labels to ai-completed after PR creation
- Files: src/commands/pr.ts
- Changes: Added missing label update logic to transition issues from ai-in-progress to ai-completed after successful PR creation.
- Decisions: Label update is provider-agnostic (applies to Claude, Gemini, etc). Non-critical errors are silently ignored.

[2026-01-11] #19 fix: correct Gemini CLI invocation for interactive implementation mode
- Files: src/lib/ai-provider.ts, src/lib/ai-provider.test.ts
- Changes: Fixed invokeAIInteractive to use `-i` flag for Gemini CLI, enabling interactive mode with initial prompt instead of one-shot mode that exits immediately.
- Decisions: Gemini requires `-i/--prompt-interactive` flag to stay in interactive mode after executing initial prompt, unlike Claude which defaults to interactive.

[2026-01-11] #21 refactor: cleanup unused code in prompts.ts
- Files: src/lib/prompts.ts
- Changes: Removed invokeClaude and invokeClaudeInteractive functions and unused imports. File now solely focuses on prompt generation.
- Decisions: Verified that functionality is fully covered by ai-provider.ts.

[2026-01-11] #21 feat: dynamic Co-Authored-By trailer
- Files: src/lib/prompts.ts, src/lib/ai-provider.ts, src/lib/prompts.test.ts, src/commands/init.ts, templates/AGENT.md
- Changes: Updated prompt generation to use dynamic provider name and email for Co-Authored-By trailer. Updated templates to be generic.
- Decisions: Using noreply@anthropic.com and noreply@google.com for respective providers.

[2026-01-11] #21 refactor: rename claude.ts to prompts.ts
- Files: src/lib/prompts.ts, src/lib/prompts.test.ts, src/commands/run.ts, src/commands/create.ts, src/commands/pr.ts, README.md, AGENT.md
- Changes: Renamed Claude-specific file to reflect its generic prompt-building nature. Updated all imports and documentation.
- Decisions: Aligned naming with the multi-model AI provider abstraction.

[2026-01-12] #23 feat: generate ticket title from CLI command prompt
- Files: src/lib/prompts.ts, src/lib/prompts.test.ts, src/commands/create.ts, src/index.ts
- Changes: Added AI-generated title extraction from ticket output. Prompt now requests TITLE line. Added extractTitle() and generateFallbackTitle() functions. Added --title flag for manual override.
- Decisions: Title limit extended to 200 chars. Fallback truncates at word boundary without ellipsis. Validation rejects placeholders and too short (<5) titles.

[2026-01-12] #25 feat: display CLI version in status and help command outputs
- Files: src/lib/version.ts, src/lib/version.test.ts, src/index.ts, src/commands/status.ts
- Changes: Created getVersion() utility to read version from package.json. Updated status command header to show version. Refactored index.ts to use shared version utility.
- Decisions: Single source of truth in package.json. Commander.js .version() already configured.

[2026-01-12] #27 feat: add version check to detect and notify users of CLI updates
- Files: src/lib/version.ts, src/lib/version.test.ts, src/index.ts, src/commands/status.ts, eslint.config.js
- Changes: Added npm registry fetch with caching (~/.gent/version-check.json), non-blocking startup check via Commander preAction hook, --skip-update-check flag, and update display in status command.
- Decisions: 24h cache interval, 3s fetch timeout, native fetch API (Node 20+). GENT_SKIP_UPDATE_CHECK=1 env var also disables checks.
[2026-01-14] #31 feat: add support for OpenAI Codex as an AI provider
- Files: src/types/index.ts, src/utils/validators.ts, src/utils/validators.test.ts, src/lib/ai-provider.ts, src/lib/ai-provider.test.ts, src/commands/init.ts, src/lib/config.ts, README.md, AGENT.md
- Changes: Added support for 'codex' as an AI provider, using the 'openai' CLI. Updated types, validators, and AI provider logic. Added 'codex' to the init command and documentation.
- Decisions: Assumed the 'openai' CLI follows a similar invocation pattern to 'gemini' and 'claude' for simplicity, as suggested by the issue. Used 'noreply@openai.com' for the co-author email.

[2026-01-14] #33 feat: add gent fix command for review feedback
- Files: src/commands/fix.ts, src/index.ts, src/lib/github.ts, src/lib/prompts.ts, src/lib/review-feedback.ts, src/lib/review-feedback.test.ts, src/lib/prompts.test.ts, src/lib/ai-provider.test.ts, src/types/index.ts
- Changes: Added gent fix command to pull PR review feedback, summarize actionable items, and re-run the implementation prompt with review context. Added review feedback parsing helpers and tests, plus prompt and GitHub helper updates.
- Decisions: Summarized actionable feedback using review states, unresolved threads, and keyword heuristics; exit when no actionable feedback exists.

[2026-01-14] #35 fix: use GraphQL API for PR review threads and add timestamp filtering
- Files: src/lib/github.ts, src/lib/git.ts, src/lib/review-feedback.ts, src/commands/fix.ts, src/types/index.ts, src/lib/review-feedback.test.ts
- Changes: Fixed getPrReviewData to use GraphQL for review threads. Added PR comments fetching. Added timestamp filtering to only show feedback after last commit (unresolved threads always shown). Added getLastCommitTimestamp helper. Auto-replies to feedback items after successful fix.
- Decisions: GraphQL query fetches repo owner/name first. Graceful fallback to empty threads if GraphQL fails. Unresolved threads always included regardless of timestamp. Reply failures silently ignored.

[2026-01-14] #37 docs: update README with gent fix workflow and PR iteration
- Files: README.md, progress.txt
- Changes: Added gent fix command documentation, updated workflow diagram to show review iteration loop, added PR review iteration tips section with usage examples.
- Decisions: Kept documentation concise with focus on practical workflow. Diagram shows branching review cycle.

[2026-01-14] #37 docs: address review feedback for README update
- Files: README.md
- Changes: Changed "items" to "comments" and "feedback" for consistency. Expanded explanation of the PR review iteration cycle.
- Decisions: Aligned terminology with reviewer suggestions.

[2026-01-15] #39 feat: enhance status command to show PR state and actionable review feedback
- Files: src/commands/status.ts, src/lib/github.ts, src/lib/review-feedback.ts, src/lib/review-feedback.test.ts
- Changes: Added getPrStatus() for PR state (open/closed/merged) and reviewDecision. Added countActionableFeedback() helper. Status now shows PR state, review decision, actionable comment counts with `gent fix` suggestion, and state-specific suggestions.
- Decisions: Reused existing extractReviewFeedbackItems logic. Suggestions adapt based on PR state and feedback availability.

[2026-01-15] #41 fix: duplicate "Update available" message in status command
- Files: src/commands/status.ts
- Changes: Removed duplicate update check from status command. The preAction hook in index.ts now handles update checks consistently for all commands.
- Decisions: Single update check strategy via preAction hook; removed special-case logic from status command.

[2026-01-26] #45 feat: add Playwright video capture for UI changes in PRs
- Files: src/types/index.ts, src/lib/config.ts, src/lib/playwright.ts, src/lib/github-assets.ts, src/commands/pr.ts, src/index.ts, src/lib/playwright.test.ts, src/lib/github-assets.test.ts
- Changes: Added VideoConfig type and configuration. Created playwright.ts for Playwright detection and UI change heuristics. When UI changes detected and Playwright available, adds instructions to AI prompt for video capture via MCP. Created github-assets.ts utility for future use.
- Decisions: Video capture enabled by default, disabled via .gent.yml or --no-video. AI handles video capture autonomously via MCP (no manual URL needed). UI detection uses file patterns (tsx, vue, components/, pages/, etc).

[2026-01-28] #47 feat: add interactive dashboard with context-aware workflow actions
- Files: src/tui/state.ts, src/tui/actions.ts, src/tui/display.ts, src/tui/state.test.ts, src/tui/actions.test.ts, src/commands/tui.ts, src/index.ts, src/lib/prompts.ts, README.md, AGENT.md, progress.txt
- Changes: Added dashboard launched via `gent` (no args) or `gent ui`. Panels for Ticket/Branch/PR/Commits with keyboard shortcuts at bottom. State aggregation from git, GitHub issues/PRs, labels, and Playwright. Video capture prompt builder for UI changes. Dashboard auto-refreshes after actions.
- Decisions: Used existing inquirer+chalk+ora instead of adding TUI library. Raw stdin for single-key input. htop-inspired panel layout with badges. No action menu - bottom command bar with shortcuts instead.

[2026-01-28] #49 fix: fix TUI command execution and standardize modal dialogs
- Files: src/commands/tui.ts, src/tui/actions.ts, src/tui/display.ts, src/tui/actions.test.ts, src/commands/create.ts, src/commands/run.ts
- Changes: Replaced process.exit calls with return in create/run commands to prevent TUI termination. Renamed fix action to implement (shortcut i) for context-aware implementation. Added renderActionPanel for framed output. Included review feedback context in implementation prompts. Added error handling around TUI command calls.
- Decisions: Kept command functions reusable by replacing process.exit with return. Action panel shows session context before handing off to AI provider.

[2026-01-28] #51 feat: replace "run next" with interactive ticket selector in list command
- Files: src/commands/list.ts, src/commands/list.test.ts, src/commands/run.ts, src/commands/tui.ts, src/tui/actions.ts, src/tui/actions.test.ts, src/index.ts, src/lib/git.ts, src/lib/github.ts
- Changes: Consolidated `switch` and `list` commands into a single interactive `gent list` command. Displays tickets grouped by status (in progress, open PRs, ready) with branch switching on selection. Removed `--auto` flag and `autoSelectIssue` from run command. Removed separate `switch` command. TUI uses unified list action (shortcut l).
- Decisions: Single command handles both listing and switching. Branch resolution scans local branches via parseBranchName, falls back to remote, offers creation if none found. Dirty working tree warning deferred until after selection.

[2026-01-28] #53 fix: hide implement action for merged PRs and inline refresh indicator
- Files: src/tui/actions.ts, src/tui/actions.test.ts, src/tui/display.ts, src/commands/tui.ts
- Changes: Added PR merged state check to hide implement action. Replaced clear-screen modal refresh with inline "Refreshing…" label in dashboard title bar, re-rendering last state while loading new data.
- Decisions: First load still uses modal since no previous state exists. Refreshing indicator shown in title row to avoid layout changes.

[2026-01-29] #56 fix: remove duplicate settings section in TUI on main branch
- Files: src/tui/display.ts, src/tui/actions.test.ts
- Changes: Removed redundant Settings section rendering from the main branch view in display.ts. Updated actions.test.ts to explicitly assert all expected actions on main branch.
- Decisions: Centralized settings rendering at the top of the dashboard for consistency across all branch types.

[2026-01-29] #58 refactor: rename 'implement' action to 'run' with 'u' shortcut
- Files: src/tui/actions.ts, src/commands/tui.ts, src/tui/actions.test.ts
- Changes: Renamed the 'implement' TUI action to 'run' and updated its keyboard shortcut to 'u'. Updated command handlers and unit tests accordingly.
- Decisions: Used 'u' for run as 'r' was taken by PR and 'c' by commit.

[2026-01-29] #62 feat: remove video command from TUI, add post-PR video suggestion
- Files: src/tui/actions.ts, src/commands/tui.ts, src/commands/pr.ts, src/tui/actions.test.ts, src/commands/tui.test.ts
- Changes: Removed video action from TUI actions and command handler. Added post-PR suggestion to run Playwright MCP for video capture and upload to GitHub Assets. Fixed AI interactive mode to properly await the subprocess result before returning to dashboard.
- Decisions: Video suggestion only shown when UI changes detected and Playwright available. AI interactive fix was awaiting the wrapper function but not the execa ResultPromise.

[2026-01-30] #64 refactor: replace TUI command interactions with floating modal dialogs
- Files: src/tui/modal.ts, src/tui/modal.test.ts, src/tui/display.ts, src/commands/tui.ts, src/commands/tui.test.ts
- Changes: Built modal overlay system (confirm, select, input, status) that renders centered floating dialogs over dimmed dashboard. Refactored display.ts to support buildDashboardLines for modal compositing. Replaced all inquirer prompts and clearScreen patterns in TUI with modal overlays. Removed unnecessary confirmation dialogs for pr, run, push, checkout-main actions. Removed promptContinue calls for auto-close behavior.
- Decisions: Custom modal system using ANSI cursor positioning over raw terminal (no new dependencies). Kept full-screen mode for AI interactive sessions and list command. Commit message generation uses non-streaming mode for modal compatibility.

[2026-01-30] #64 refactor: convert list command and PR flow to modal dialogs
- Files: src/commands/tui.ts, src/commands/tui.test.ts, src/commands/pr.ts
- Changes: Converted list command from clearScreen+inquirer to modal select overlay with category separators. Added modal-based branch switching with dirty-state confirmation and branch creation dialogs. Removed inquirer push confirmation from PR command (auto-push). Fixed process.exit calls in pr.ts to use return for TUI compatibility.
- Decisions: List modal fetches tickets inline and builds SelectEntry items with separators. Full-screen kept only for AI streaming (create, pr, run).

[2026-01-30] #66 fix: multiline input for new ticket dialog
- Files: src/tui/modal.ts, src/tui/modal.test.ts, src/commands/tui.ts, src/commands/tui.test.ts
- Changes: Added buildMultilineInputContent and showMultilineInput to modal system with word wrapping, newline support (Enter), and Ctrl+S submit. Replaced showInput with showMultilineInput in the create action.
- Decisions: Used Ctrl+S for submit since Ctrl+Enter is unreliable across terminal emulators. Added word-wrap at content width boundaries.

[2026-01-30] #68 feat: add manual refresh and improve branch switching UX

- Files: src/tui/actions.ts, src/commands/tui.ts, src/tui/actions.test.ts, src/commands/tui.test.ts

- Changes: Added manual refresh action (shortcut 'f'). Removed 'main' shortcut from feature branches. Updated list command to include main branch option and disable it when uncommitted changes exist with a descriptive warning.

- Decisions: Centralized main branch switching in list command to reduce UI clutter. Used upfront dirty check in list command for better UX.



[2026-01-30] #70 fix: show master/main branch in branch section with consistent UX
- Files: src/tui/display.ts, src/tui/display.test.ts
- Changes: Refactored dashboard rendering to always show the current branch in the branch section, including master/main. Hidden irrelevant sections (Ticket, PR, Commits) on main branch for a cleaner look.
- Decisions: Integrated main branch into standard section-based layout while maintaining "ready to start new work" hint.

[2026-01-30] #72 fix: prefix dashboard list items with bullet markers and prevent text overflow
- Files: src/tui/display.ts, src/tui/modal.ts, src/tui/display.test.ts, src/tui/modal.test.ts
- Changes: Added consistent `· ` bullet prefix to list items (commits, tickets, PRs) in dashboard and modal selectors. Implemented `truncateAnsi` in `display.ts` and updated `row()` to automatically truncate overflowing text with an ellipsis.
- Decisions: Used `· ` for a clean TUI look. Centralized `truncateAnsi` in `display.ts` for reuse in modals.

[2026-01-30] #75 feat: add periodic version check to TUI dashboard
- Files: src/tui/display.ts, src/tui/display.test.ts, src/commands/tui.ts
- Changes: Added update notification below GitHub status in TUI settings section. Version check runs in parallel with state aggregation using existing `checkForUpdates` with 30-minute throttle. Shows "Update available: X → Y" with upgrade command when newer version exists.
- Decisions: Reused existing `checkForUpdates` disk cache (no new in-memory cache needed). Non-blocking via `Promise.all` alongside `aggregateState`. No notification when up-to-date.

[2026-01-30] #75 perf: cache environment checks in TUI session
- Files: src/tui/state.ts, src/tui/state.test.ts
- Changes: Cached `checkGhAuth`, `checkAIProvider`, and `isPlaywrightAvailable` results after first call. These environment checks don't change mid-session, so subsequent refreshes skip the subprocess calls.
- Decisions: Session-level in-memory cache with `resetEnvCache()` exposed for testing. Playwright check deferred until first feature branch visit.

[2026-01-30] #77 feat: highlight current ticket in TUI switch list
- Files: src/commands/tui.ts, src/commands/tui.test.ts, src/tui/modal.ts, src/tui/modal.test.ts
- Changes: Added `currentIndex` to `buildSelectContent` and `showSelect` to style the active ticket with `chalk.cyan`. Added `initialIndex` so cursor starts on the current ticket. Reverted cursor-selection inverse styling (kept bold).
- Decisions: Used color-only highlighting (no added text) to avoid truncation in narrow modals. Pre-selecting current ticket reduces navigation effort.

[2026-01-31] #79 docs: update documentation with TUI-first approach
- Files: README.md, AGENT.md, progress.txt
- Changes: Rewrote README to lead with dashboard as primary interface. Added dedicated Dashboard section with panels, keyboard shortcuts, modal dialogs, and typical workflow. Renamed "Commands" to "CLI Reference" as secondary. Updated workflow diagram to use dashboard shortcuts. Updated AGENT.md architecture description.
- Decisions: Quick Start now ends with "Launch the dashboard" instead of individual CLI commands. Added "Dashboard vs CLI" tips section. Added GENT_SKIP_UPDATE_CHECK to env vars table.

[2026-01-31] #79 refactor: remap TUI shortcuts and use bracket notation
- Files: src/tui/actions.ts, src/tui/display.ts, src/tui/actions.test.ts, src/tui/display.test.ts, README.md
- Changes: Remapped shortcuts: push `p`→`s` (send), PR `r`→`p`, run `u`→`r`. Changed command bar format from inline letter highlighting to explicit `[x]label` bracket notation. Updated tests and README.
- Decisions: `s` for push (send/sync), `p` for PR, `r` for run — each action uses its natural first letter. Bracket notation is more explicit than coloring a letter within a word.

[2026-01-31] #81 fix: improve hint section when not in a git repo
- Files: src/tui/display.ts, src/tui/display.test.ts
- Changes: Render command bar (with quit shortcut) in non-git-repo and non-authenticated error states instead of closing the box early. Improved non-git message to "Navigate to a git repository to get started".
- Decisions: Changed error color from red to yellow for non-git state since it's informational, not an error. Applied same command bar fix to the non-authenticated state for consistency.

[2026-01-31] #82 feat: add cursor movement and full editing support to multiline input
- Files: src/tui/modal.ts, src/tui/modal.test.ts
- Changes: Added cursor position tracking, arrow key navigation (left/right/up/down across visual lines), Home/End/Ctrl+A/Ctrl+E, Ctrl+Left/Right word jump, Delete key, mid-text insertion/deletion. Added visual line mapping (getVisualLines, findCursorVisualPos) for cursor-to-screen coordinate translation through word-wrap. Decoded new ANSI sequences in readKey().
- Decisions: Replaced wrapLine with wrapLineWithMap that tracks character offsets through word-wrap breaks. Cursor movement helpers are exported pure functions for testability. Kept cursorPos optional in buildMultilineInputContent for backward compatibility.

[2026-01-31] #85 feat: gate new and pr actions on valid git remote
- Files: src/tui/state.ts, src/tui/actions.ts, src/tui/display.ts, src/tui/actions.test.ts, src/tui/state.test.ts, src/tui/display.test.ts, src/commands/tui.ts, src/commands/tui.test.ts
- Changes: Added `hasValidRemote` field to TuiState, populated via `getRepoInfo()`. Gated "new" and "pr" actions on valid remote. Added hint in display when remote is missing.
- Decisions: Reused existing `getRepoInfo()` from git.ts. Remote check runs in parallel with other git state queries. Hint displayed in dedicated section, takes priority over custom hints.
